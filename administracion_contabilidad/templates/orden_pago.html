{% extends 'base_table_v2.html' %}
{% load static %}
{% block contenido %}
{% include 'menu/menu_pagos.html' %}

<style>
.ui-autocomplete {
    z-index: 3050;
}
    .payment-section {
  display: none;
}
    #paymentModal {
  font-family: Arial, sans-serif;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 2px solid #ccc;
  padding-bottom: 10px;
}

.payment-methods {
  margin: 20px 0;
}

.payment-methods label {
  margin-right: 15px;
}

.payment-section {
  margin-top: 20px;
}

.footer-section input {
  width: 100px;
  margin-left: 10px;
}

.observations input {
  width: 100%;
}

.icon-btn {
  background: none;
  border: none;
  cursor: pointer;
}

    /* Clase para resaltar filas seleccionadas */
.selected {
    background-color: #d1ecf1 !important; /* Cambia el color según tu preferencia */
    color: #0c5460; /* Ajusta el color del texto */
}


</style>




<table id="tabla_cobranzas" class="table table-striped table-bordered" cellspacing="0" width="100%">
        <thead>
        <tr>
            <th class="text-left">Autogenerado</th>
            <th class="text-left">Fecha</th>
            <th class="text-left">Cliente</th>
            <th class="text-left">Documento</th>
            <th class="text-left">Total</th>
            <th class="text-left">Monto</th>
            <th class="text-left">IVA</th>
            <th class="text-left">Moneda</th>
        </tr>

        </thead>
        <tbody>

        </tbody>
        <tfoot>
        <tr>
            <th class="text-right">Autogenerado</th>
            <th class="text-right">Fecha</th>
            <th class="text-right">Cliente</th>
            <th class="text-right">Documento</th>
            <th class="text-right">Total</th>
            <th class="text-right">Monto</th>
            <th class="text-right">IVA</th>
            <th class="text-right">Moneda</th>
        </tr>
        </tfoot>
    </table>


<div id="dialog-form" title="Formulario de Pago" style="display: none;">
<div class="border rounded p-4 bg-light">


    <form method="post" action="" id="cobranzaForm">
        {% csrf_token %}
        <div style="display:inline-flex;width:100%;">
        <div class="col-md-10">
        <div class="row d-flex align-items-center">


           <h3 class="col-md-3 text-center"
                style="font-weight: bold; color: white; font-family: Arial, sans-serif; background-color: black;
               padding: 2px 2px; border-radius: 3px; height: 40px; display: flex; align-items: center; justify-content: center;
               margin-top: 8px;">
                Orden de Pago
            </h3>

            <div class="col-md-2">
                {{ form.numero }}
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-md-12">
                <div class="form-check">
                    <input class="form-check-input" type="radio" id="definitivo" name="opcion" checked>
                    <label class="form-check-label" for="definitivo">
                        Definitivo
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" id="intencion" name="opcion">
                    <label class="form-check-label" for="intencion">
                        Intención
                    </label>
                </div>
            </div>
        </div>
        <br>
        <div class="row">

            <div class="col-md-2">
                {{ form.fecha.label_tag }}
                {{ form.fecha }}
            </div>
        </div>
        <br>
        <div class="row mt-3">
            <div class="col-md-4">
                {{ form.moneda.label_tag }}
                {{ form.moneda }}
            </div>
            <div class="col-md-2">
                {{ form.arbitraje.label_tag }}
                {{ form.arbitraje }}
            </div>
            <div class="col-md-2">
                {{ form.paridad.label_tag }}
                {{ form.paridad }}
            </div>
            <div class="col-md-2">
                {{ form.imputar.label_tag }}
                {{ form.imputar }}
            </div>
        </div>
        <br>
        <div class="col-md-2">
            {{form.importe.label_tag}}
            {{form.importe}}
        </div>
        <div class="row mt-3">
            <div class="d-flex align-items-center col-md-12">
                <div class="col-md-3">
                    <label for="cliente">Buscar Cliente</label>
                    <input type="text" id="cliente_cobranza" class="form-control" name="cliente" placeholder="Buscar cliente">
                    <input type="hidden" id="cliente_cobranza_hidden">
                </div>
            </div>
            <div class="col-md-6 offset-md-1">
                <table id="clienteTable" class="table table-striped" style="display:none;">
                    <thead>
                        <tr>
                            <th class="d-none">Codigo</th>
                            <th>Empresa</th>
                            <th>RUT</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        </div>
        <div class="col-md-2" >

        <div>
            <button type="button" id="deshacer" class="btn btn-danger w-100 mb-3" disabled>Deshacer</button>
            <button type="button" class="btn btn-warning w-100 mb-3" id="imputarSeleccion" disabled>Imputar selección</button>
            <button type="button" class="btn btn-success w-100 mb-3" onclick="abrir_forma_pago()" id="abrirpago" disabled>Cobrar</button>
        </div>
        <div class="input-group mb-3">
            <input type="text" id="embarque" class="form-control" name="embarque" placeholder="Nro embarque">
            <button class="btn btn-primary" type="button">
                <i class="fas fa-search"></i>
            </button>
        </div>
        <div>
            <label for="a_imputar">A imputar</label>
            <input type="number" id="a_imputar" class="form-control mb-3" name="a_imputar" value="0.0" readonly>
        </div>
        <div>
            <label for="acumulado">Acumulado</label>
            <input type="number" id="acumulado" class="form-control mb-3" name="acumulado" value="0.0" readonly>
        </div>
        <div>
            <label for="balance">Balance</label>
            <input type="number" id="balance" class="form-control mb-3" name="balance" value="0.0" readonly>
        </div>
    </div>
        </div>

        <table id="imputacionTablePagos" class="table table-striped mt-4" style="display:block; overflow-x:auto;">
            <thead>
                <tr>
                    <th style="display:none;">Id</th>
                    <th>Fecha</th>
                    <th>Documento</th>
                    <th>Total</th>
                    <th>Monto</th>
                    <th>IVA</th>
                    <th>Tipo</th>
                    <th>Moneda</th>
                    <th>Saldo</th>
                    <th>Imputado</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>

    </form>


</div>
</div>

<div id="paymentModal" title="Forma de Pago" style="display: none;">
  <!-- Header del modal -->
  <div class="modal-header d-flex justify-content-between align-items-center">
    <h3 style="color:black;">A cobrar: <span id="amount" class="text-primary fw-bold"></span></h3>
    <div class="modal-icons">
      <button class="icon-btn"><i class="ui-icon-folder-open"></i></button>
      <button class="icon-btn"><i class="ui-icon-disk"></i></button>
    </div>
  </div>

  <!-- Radio buttons -->
  <div class="payment-methods">
    <label><input type="radio" name="paymentType" id="efectivo" value="cash" checked> Efectivo</label>
    <label><input type="radio" name="paymentType" id="cheque" value="check"> Cheque</label>
    <label><input type="radio" name="paymentType" id="trans" value="transfer"> Transferencia</label>
    <label><input type="radio" name="paymentType" id="deposito" value="deposit"> Depósito</label>
    <label><input type="radio" name="paymentType" id="otro" value="other"> Otro</label>
    <label><input type="radio" name="paymentType" id="cheque_terceros" value="terceros"> Cheque de terceros</label>
  </div>

  <!-- Secciones dinámicas -->
  <!-- efectivo -->
  <div id="cashSection" class="payment-section">
    <div>
      <label for="id_cuenta_efectivo">Caja o Banco imputado:</label>
        {{ form.cuenta_efectivo }}
    </div>
    <div>
      <label for="cashAmount">Monto:</label>
      <input type="number" id="cashAmount" value="200" class="form-control">
    </div>
    <div>
      <label for="id_moneda_efectivo">Moneda:</label>
        {{ form.moneda_efectivo }}
    </div>
  </div>

  <!-- cheques -->
<div id="checkSection" class="payment-section" style="display: none;">
  <div class="row mb-3">
    <div class="col-md-6">
      <label for="id_cuenta_cheque" class="form-label">Caja o Banco imputado:</label>
        {{ form.cuenta_cheque }}
    </div>
    <div class="col-md-6">
      <label for="checkAmount" class="form-label">Monto:</label>
      <input type="number" class="form-control" id="checkAmount" value="900">
    </div>
  </div>

  <div class="row mb-3">
          <div class="col-md-6">
      <label for="checkEmission" class="form-label">Emisión:</label>
      <input type="date" class="form-control" id="checkEmission">
    </div>
<div class="col-md-6">
      <label for="checkDueDate" class="form-label">Vto.:</label>
      <input type="date" class="form-control" id="checkDueDate">
    </div>

  </div>



  <div class="row mb-3">

      <div class="col-md-6">
      <label for="checkNumber" class="form-label">Número de Cheque:</label>
      <input type="number" class="form-control" id="checkNumber">
    </div>
    <div class="col-md-6">
      <label for="id_banco_cheque" class="form-label">Banco:</label>
        {{ form.banco_cheque }}
    </div>
  </div>
    <div class="col-md-6">
    <div>
      <label for="id_moneda_cheque">Moneda:</label>
        {{ form.moneda_cheque }}
    </div>
    </div>

</div>

      <!-- transferencia -->
<div id="transferSection" class="payment-section" style="display: none;">
  <div class="row mb-3">
    <div class="col-md-6">
      <label for="id_cuenta_transferencia" class="form-label">Caja o Banco imputado:</label>
{{ form.cuenta_transferencia }}
    </div>
    <div class="col-md-6">
      <label for="checkAmount_trans" class="form-label">Monto:</label>
      <input type="number" class="form-control" id="checkAmount_trans" value="900">
    </div>
  </div>

  <div class="row mb-3">
          <div class="col-md-6">
      <label for="checkEmission_trans" class="form-label">Emisión:</label>
      <input type="date" class="form-control" id="checkEmission_trans">
    </div>
<div class="col-md-6">
      <label for="checkDueDate_trans" class="form-label">Vto.:</label>
      <input type="date" class="form-control" id="checkDueDate_trans">
    </div>

  </div>

  <div class="row mb-3">

      <div class="col-md-6">
      <label for="checkNumber_trans" class="form-label">Número:</label>
      <input type="number" class="form-control" id="checkNumber_trans">
    </div>
    <div class="col-md-6">
      <label for="id_banco_transferencia" class="form-label">Banco:</label>
        {{ form.banco_transferencia }}
    </div>
  </div>

    <div class="row mb-3">
        <div class="col-md-6">
            <label for="cuenta_trans" class="form-label">Cuenta:</label>
            <input type="number" class="form-control" id="cuenta_trans">
        </div>
            <div>
      <label for="id_moneda_transferencia">Moneda:</label>
        {{ form.moneda_transferencia }}
    </div>
    </div>


</div>

      <!-- deposito -->
<div id="depositSection" class="payment-section" style="display: none;">
  <div class="row mb-3">
    <div class="col-md-6">
      <label for="id_cuenta_deposito" class="form-label">Caja o Banco imputado:</label>
{{ form.cuenta_deposito }}
    </div>
    <div class="col-md-6">
      <label for="checkAmount_deposito" class="form-label">Monto:</label>
      <input type="number" class="form-control" id="checkAmount_deposito" value="900">
    </div>
  </div>

  <div class="row mb-3">
          <div class="col-md-6">
      <label for="checkEmission_deposito" class="form-label">Emisión:</label>
      <input type="date" class="form-control" id="checkEmission_deposito">
    </div>
<div class="col-md-6">
      <label for="checkDueDate_deposito" class="form-label">Vto.:</label>
      <input type="date" class="form-control" id="checkDueDate_deposito">
    </div>

  </div>

  <div class="row mb-3">

      <div class="col-md-6">
      <label for="checkNumber_deposito" class="form-label">Número:</label>
      <input type="number" class="form-control" id="checkNumber_deposito">
    </div>
    <div class="col-md-6">
      <label for="id_banco_deposito" class="form-label">Banco:</label>
{{ form.banco_deposito }}
    </div>
  </div>

    <div class="row mb-3">
        <div class="col-md-6">
            <label for="cuenta_deposito" class="form-label">Cuenta:</label>
            <input type="number" class="form-control" id="cuenta_deposito">
        </div>
                    <div>
      <label for="id_moneda_deposito">Moneda:</label>
        {{ form.moneda_deposito }}
    </div>
    </div>

</div>

      <!-- otro -->
<div id="otherSection" class="payment-section" style="display: none;">
  <div class="row mb-3">
    <div class="col-md-6">
      <label for="id_cuenta_otro" class="form-label">Cuenta:</label>
    {{ form.cuenta_otro }}
    </div>
    <div class="col-md-6">
      <label for="checkAmount_otro" class="form-label">Monto:</label>
      <input type="number" class="form-control" id="checkAmount_otro" value="900">
    </div>
  </div>

  <div class="row mb-3">
          <div class="col-md-6">
      <label for="checkEmission_otro" class="form-label">Emisión:</label>
      <input type="date" class="form-control" id="checkEmission_otro">
    </div>
<div class="col-md-6">
      <label for="checkDueDate_otro" class="form-label">Vto.:</label>
      <input type="date" class="form-control" id="checkDueDate_otro">
    </div>

  </div>

  <div class="row mb-3">

      <div class="col-md-6">
      <label for="checkNumber_otro" class="form-label">Número:</label>
      <input type="number" class="form-control" id="checkNumber_otro">
    </div>
    <div class="col-md-6">
      <label for="id_banco_otro" class="form-label">Banco:</label>
    {{ form.banco_otro }}
    </div>
  </div>

    <div class="row mb-3">
        <div class="col-md-6">
            <label for="cuenta_otro" class="form-label">Cuenta:</label>
            <input type="number" class="form-control" id="cuenta_otro">
        </div>
            <div>
      <label for="id_moneda_otro">Moneda:</label>
        {{ form.moneda_otro }}
    </div>
    </div>

</div>

<div id="tercerosSection" class="payment-section" style="display: none;">
  <div class="row mb-3">
    <div class="col-md-6">
    <div>
      <label for="id_moneda_cheque_terceros" class="form-label">Moneda:</label>
        {{ form.moneda_cheque_terceros }}
    </div>
    </div>
    <div class="col-md-6">
      <label for="checkAmount" class="form-label">Monto:</label>
      <input type="number" class="form-control" id="checkAmountTerceros" value="" readonly>
    </div>
  </div>




</div>
  <!-- Observaciones y cierre -->
    <br>
    <div style="text-align:right;">
        <button type="button" class="btn btn-success" onclick="ingresar_datos()">Ingresar datos</button>
        <button type="button" class="btn btn-danger" onclick="borrar_datos()">Borrar datos</button>
    </div>
    <hr>
    <div class="container mt-4">
  <div class="table-responsive">
    <table id="exampleTable" class="table table-bordered table-hover table-striped">
      <thead class="table-light">
        <tr>
          <th>Modo</th>
          <th>Emisión</th>
          <th>Banco</th>
          <th>Número</th>
          <th>Moneda</th>
          <th>Total</th>
          <th>T.C.</th>
          <th>Vencimiento</th>
          <th>Cuenta</th>
        </tr>
      </thead>
      <tbody>

      </tbody>
    </table>
  </div>
</div>
 <hr>
<div class="extras">
    <!-- Fila de Retención IRPF -->
    <div class="row mb-3">
        <div class="col-2">
            <label for="retencion_irpf" class="me-3">Retención IRPF</label>
            <input type="checkbox" name="" id="retencion_irpf">
        </div>
        <div class="col-1">
            <input type="number" name="" id="monto_irpf" class="form-control" value="0" disabled>
        </div>
        <div class="col-3">
            <select class="form-control" id="retenciones_irpf_select" disabled>
                <!-- Opciones -->
            </select>
        </div>
    </div>

    <!-- Fila de Retención IVA -->
    <div class="row mb-3">
        <div class="col-2">
            <label for="retencion_iva" class="me-3">Retención IVA</label>
            <input type="checkbox" name="" id="retencion_iva">
        </div>
        <div class="col-1">
            <input type="number" name="" id="monto_iva" class="form-control" value="0" disabled>
        </div>
        <div class="col-3">
            <select class="form-control" id="retenciones_iva_select" disabled>
                <!-- Opciones -->
            </select>
        </div>
    </div>
</div>

    <hr>
  <div class="observations">
    <label for="observations">Obs.:</label>
    <input type="text" id="observations">
      <label for="id_cuenta_observaciones">Diferencia a: </label>
        {{ form.cuenta_observaciones }}
  </div>
    <hr>
    <div class="iva_container">

    <div class="row mb-3">
        <div class="col-2">
            <label for="descuento" class="me-3">Descuento</label>
            <input type="checkbox" name="" id="descuento">
        </div>
        <div class="col-1">
            <input type="number" name="" id="monto_iva_dos" class="form-control" value="0" >
        </div>
        <div class="col-3">
            <select class="form-control" id="retenciones_iva_select_dos" >
                <!-- Opciones -->
            </select>
        </div>
    </div>

    </div>
    <hr>
  <div class="footer-section d-flex justify-content-between mt-4">
    <div>
      <label for="accumulated">Acumulado:</label>
      <input type="text" id="accumulated" value="0.0000" class="form-control" readonly>
      <label for="difference">Diferencia:</label>
      <input type="text" id="difference" value="0.0000" class="form-control" readonly>
    </div>


  </div>
</div>

<div id="cheques_disponibles" title="Cheques disponibles" style="display: none;">
<div class="d-flex align-items-center col-md-12">
    <div class="col-md-3">
        <label for="cliente">Buscar Cliente</label>
        <input type="text" id="cliente_terciarizado_buscar" class="form-control" name="cliente" placeholder="Buscar cliente">
        <input type="hidden" id="id_buscar_terciarizado">
    </div>
</div>
<table id="tabla_cheques_disponibles" class="table table-striped mt-4" style="display:block; overflow-x:auto;">
            <thead>
                <tr>
                    <th style="display:none;">Id</th>
                    <th style="display:none;">moneda</th>
                    <th>Vto</th>
                    <th>Emisión</th>
                    <th>Banco</th>
                    <th>Número</th>
                    <th>Cliente</th>
                    <th>Total</th>
                    <th>Bajar</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
</div>

<script>
    var csrf_token = "{{ csrf_token }}";
</script>

<script src="{% static 'js/jquery-ui.min_last.js' %}"></script>
<script src="{% static 'datatables/jquery.dataTables_last.min.js' %}"></script>
<script src="{% static 'grilla/orden_pago.js' %}"></script>
<link rel="stylesheet" href="{% static 'jquery-ui/jquery-ui_last.css' %}">
{% endblock contenido %}



